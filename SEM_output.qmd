---
format: html
title: SEM output
execute:
  echo: false
bibliography: bibliography.bib
csl: science-advances.csl
editor: 
  markdown: 
    wrap: sentence
---


```{r}
#| label: set-up
#| echo: false
#| message: false
library(targets)
library(tarchetypes)
library(tidyverse)
library(lubridate)
library(broom)
library(gt)
library(piecewiseSEM)
library(patchwork)
library(ggpubr)
```


## Introduction and hypothesis

```{r}
#| label: fig-concept
#| echo: false
#| warning: false
#| fig-cap: Impacts of the global change drivers climate warming, atmospheric nitrogen deposition, and grazing on alpine plant communities, and the experimental design to assess interactions among multiple drivers.

knitr::include_graphics("figures/concept.png")

```


## Methods

### Calculating standing biomass

Standing biomass is estimated from the community data using *sum of cover x vegetation height*. This estimated biomass is then backtransformed to actual biomass using the biomass collected at peak growing season in the control plots


```{r}
#| label: fig-bio-calc-coll
#| echo: false
#| warning: false
#| fig-cap: Relationship between collected and estimated standing biomass in the control plots.

tar_read(standing_biomass_back_fig)

```




## Results

### Biomass and diversity

```{r}
#| label: fig-bio-div
#| echo: false
#| warning: false
#| fig-height: 10
#| fig-cap: Relationship of standing biomass and Shannon diversity.

tar_load(standingB_div_figure)
standingB_div_figure

```



### Structural equation model

**Only direct effects**

```{r}
#| label: direct-effects
#| echo: true
#| eval: false

model <- psem(
  lm(diversity ~ biomass + warming + nitrogen + cutting + site, dat)
  )

```

Log ratio Shannon diversity
Log ratio biomass

```{r}
#| label: fig-direct-sem-model
#| echo: false
#| message: false
#| fig-width: 10
#| fig-cap: Direct effects of warming, nitrogen addition and cutting on Shannon diversity.

tar_load(direct_sem_cutting)
plot(direct_sem_cutting)

```

```{r}
#| label: fig-direct-sem-model2
#| echo: false
#| message: false
#| fig-width: 10
#| fig-cap: Direct effects of warming, nitrogen addition and grazing on Shannon diversity.

tar_load(direct_sem_grazing)
plot(direct_sem_grazing)

```

**Direct and indirect effects**

```{r}
#| label: biomass-model
#| echo: true
#| eval: false

model <- psem(
  lm(diversity ~ biomass + warming + nitrogen + cutting + site, dat),
  lm(biomass ~ warming + nitrogen + cutting + site, dat)
  )

```

**Final biomass and diversity**

```{r}
#| label: fig-sem-final-model
#| echo: false
#| message: false
#| fig-width: 10
#| fig-cap: Direct effects of warming, nitrogen addition and cutting/grazing and indirectly through biomass on Shannon diversity.

tar_read(sem_final_fig)

```

**Change in biomass and diversity**

```{r}
#| label: fig-sem-change-model
#| echo: false
#| message: false
#| fig-width: 10
#| fig-cap: Direct effects of warming, nitrogen addition and cutting/grazing and indirectly through Δbiomass on ΔShannon diversity.

tar_read(sem_change_fig)

```


**SEM by origin**

```{r}
#| label: fig-sem-origin
#| echo: false
#| message: false
#| fig-width: 10
#| fig-height: 10
#| fig-cap: Direct effects of warming, nitrogen addition and cutting/grazing and indirectly through biomass on species richness and evenness.

tar_read(SEM_origin_fig)

```


**SEM without site**

```{r}
#| label: fig-sem-without-site
#| echo: false
#| message: false
#| fig-width: 10
#| fig-height: 10
#| fig-cap: Direct effects of warming, nitrogen addition and cutting/grazing and indirectly through biomass on species richness and evenness.

tar_read(SEM_without_site_fig)

```


**Other diversity indices: species richness and evenness**

```{r}
#| label: fig-sem-diversity
#| echo: false
#| message: false
#| fig-width: 10
#| fig-height: 10
#| fig-cap: Direct effects of warming, nitrogen addition and cutting/grazing and indirectly through biomass on species richness and evenness.

tar_read(SEM_diversity_fig)

```


### Traits vs biomass

```{r}
#| label: fig-traits
#| echo: false
#| message: false
#| fig-width: 10
#| fig-cap: Biomass vs. SLA

tar_read(trait_fig)

```

